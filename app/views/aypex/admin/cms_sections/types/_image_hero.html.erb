<% content_for :side_bar_title do %>
  <%= form_with model: @object, scope: :cms_component, url: aypex.admin_cms_page_cms_section_cms_components_path(@cms_page, @cms_section), class: "row", data: {controller: "form-validation"}, method: :post, id: :cms_component_create do |f| %>
    <%= f.hidden_field :type, value: "Aypex::Cms::Component::ImageHero" %>
    <%= submit_tag "Add Component", class: "btn btn-light" %>
  <% end %>
<% end %>

<div class="accordion accordion-flush"
     id="accordionFlushExample"
     data-controller="sortable"
     data-sortable-resource-name-value="cms_component"
     data-sortable-response-kind-value="turbo-stream">

  <% @cms_section.cms_components.each_with_index do |component, index| %>
    <div id="<%= dom_id(component) %>"
         class="accordion-item"
         data-sortable-update-url="<%= aypex.update_position_admin_cms_page_cms_section_cms_component_path(@cms_page, @cms_section, component) %>"
         data-stream-exit-class="animate__fadeOut">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#hero_<%= index %>" aria-expanded="false" aria-controls="flush-collapseOne">
          <%= aypex_admin_svg_tag "grip-vertical.svg", size: '20px * 20px', class: 'me-2 handle' %> <%= component.headline %>
        </button>
      </h2>
      <div id="hero_<%= index %>" class="accordion-collapse collapse" data-bs-parent="#hero_<%= index %>">
        <div class="accordion-body">
            <% image = component.image || component.build_image %>

            <%= f.fields_for :cms_components, component do |comp| %>

              <%= f.field_container :image do %>
                <% if image.persisted? %>
                  <div class="image-container" style="--aspect-ratio:12/5;">
                    <%= image_tag(image.generate_url(width: 600), alt: image.alt, class: "w-100") %>
                  </div>
                <% end %>
              <% end %>

              <%= comp.fields_for :image, image do |img| %>
                <div class="mb-3">
                  <%= img.file_field :attachment %>
                </div>

                <div class="form-group form-floating">
                  <%= img.text_area :alt, rows: 4 %>
                  <%= img.label :alt, I18n.t("aypex.admin.alt_text") %>
                </div>
              <% end %>

              <%= f.field_container :headline do %>
                <%= comp.text_field :headline %>
                <%= comp.label :headline, I18n.t('aypex.admin.headline') %>
              <% end %>

              <%= f.field_container :subtitle do %>
                <%= comp.text_field :subtitle %>
                <%= comp.label :subtitle, I18n.t('aypex.admin.subtitle') %>
              <% end %>

              <%= f.field_container :button_text do %>
                <%= comp.text_field :button_text %>
                <%= comp.label :button_text %>
              <% end %>

              <%= f.field_container :linked_resource_type  do %>
                <%= comp.select(:linked_resource_type, aypex_humanize_dropdown_values('Aypex::Cms::Component::ImageHero',
                                                        { const: 'LINKED_RESOURCE_TYPES' }),
                                                        { include_blank: false }) %>

                <%= comp.label :linked_resource_type, I18n.t('aypex.admin.link_to') %>
              <% end %>

              <%= render "aypex/admin/shared/link_fields", resource: component, f: comp %>
            <% end %>

        </div>
      </div>
    </div>
  <% end %>
</div>
