<%= form_with model: @promotion, url: object_url, method: :put, data: { controller: 'form-state' } do |f| %>
  <%= f.fields_for :promotion_rules, promotion_rule do |pr|%>
    <%= f.field_container :category_ids do %>
      <%= pr.select :category_ids, options_from_collection_for_select(promotion_rule.categories, :id, :pretty_name, promotion_rule.category_ids), { include_hidden: false }, multiple: true,
                                      placeholder: I18n.t('aypex.admin.search_products_by_name_or_sku'),
                                      data: {
                                              form_state_target: 'watch',
                                              controller: 'ts--search',
                                              ts__search_endpoint_value: 'categories',
                                              ts__search_txt_value: 'pretty_name',
                                              ts__search_fields_value: ['pretty_name'],
                                              ts__search_ransack_value: ['pretty_name_i_cont']
                                            } %>

      <%= pr.label :category_ids, I18n.t('aypex.admin.categories') %>
    <% end %>


    <%= f.field_container :match_policy do %>
      <% opts = options_for_select(Aypex::Promotion::Rules::Category::MATCH_POLICIES.map{ |s| [I18n.t("aypex.admin.match_#{s}"), s] }, promotion_rule.match_policy) %>

      <%= pr.select :match_policy, opts, { include_hidden: false, include_blank: false } %>
      <%= pr.label :match_policy, I18n.t('aypex.admin.the_promotion_applies_to_products') %>
    <% end %>
  <% end %>

  <div class="text-end">
    <%= render partial: 'aypex/admin/shared/submit_button' %>
  </div>
<% end %>
