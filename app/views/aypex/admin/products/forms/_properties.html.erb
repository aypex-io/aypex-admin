<%= turbo_frame_tag :product_properties do %>
  <%= form_with model: [:admin, @product], data: {controller: "form-state"} do |f| %>
    <div class="card">
      <div class="card-header d-flex">
        <div class="flex-fill">
          <h5 class="card-title"><%= I18n.t('aypex.admin.products.properties') %></h5>
        </div>
        <div>
          <% if can? :create, Aypex::ProductProperty %>
            <%= link_to_with_icon(I18n.t('aypex.admin.products.select_from_prototype'), aypex.prototypes_admin_product_product_properties_path(@product), icon: 'list.svg', class: 'btn btn-secondary btn-sm', data: { turbo_frame: :modal}) if Aypex::Prototype.any? %>
            <%= link_to_with_icon I18n.t('aypex.admin.products.add_new_property'), aypex.new_admin_product_product_property_path(@product), icon: 'plus-square.svg', class: 'btn btn-secondary btn-sm', data: { turbo_frame: :modal } %>
          <% end %>
        </div>
      </div>

      <% if @product.properties.any? %>
      <div class="table-responsive">
        <table id="product_properties" class="table">
          <thead class="text-muted">
            <tr data-hook="product_properties_header">
              <th></th>
              <th><%= Aypex.t(:name) %></th>
              <th><%= Aypex.t(:value) %></th>
              <th class="text-center"><%= Aypex.t(:show) %></th>
              <th class="actions"></th>
            </tr>
          </thead>
          <tbody data-controller="sortable" data-sortable-resource-name-value="product_property">
            <%= f.fields_for :product_properties do |pp_form| %>
              <%= render 'aypex/admin/product_properties/product_property_fields', f: pp_form if pp_form.object.persisted? %>
            <% end %>
          </tbody>
        </table>
      </div>
      <% else %>
        <% if can? :create, Aypex::ProductProperty %>
          <div class="text-center m-4">
            <%= I18n.t('aypex.admin.products.add_first_property') %>
          </div>
        <% end %>
      <% end %>

      <div class="card-footer">
        <%= render partial: 'aypex/admin/shared/resource_actions' %>
      </div>
    </div>
  <% end %>
<% end %>
