<fieldset id="risk_analysis">
  <legend><%= "#{Aypex.t(:risk_analysis)}: #{Aypex.t(:not) unless @order.is_risky?} #{Aypex.t(:risky)}" %></legend>
  <div class="table-responsive border rounded">
    <table class="table table-condensed border rounded">
      <thead class="text-muted">
        <th><%= I18n.t('aypex.admin.risk') %></th>
        <th><%= I18n.t('aypex.admin.status') %></th>
      </thead>
      <tbody id="risk-analysis" data-hook="order_details_adjustments" class="with-border">
        <tr>
          <td>
            <strong><%= Aypex.t(:failed_payment_attempts) %>:</strong>
          </td>
          <td>
            <span class="badge rounded-pill bg-<%= @order.payments.failed.size > 0 ? 'void' : 'complete' %>">
              <%= link_to "#{Aypex.t 'payments_count', count: @order.payments.failed.size, default: pluralize(@order.payments.failed.size, Aypex.t(:payment))}", aypex.admin_order_payments_path(@order) %>
            </span>
          </td>
        </tr>

        <tr>
          <td><strong><%= Aypex.t(:avs_response) %>:</strong></td>
          <td>
            <span class="badge rounded-pill bg-<%= latest_payment.is_avs_risky? ? 'void' : 'complete' %>">
              <% if latest_payment.is_avs_risky? %>
                <%= "#{Aypex.t(:error)}: #{avs_response_code[latest_payment.avs_response]}" %>
              <% else %>
                <%= Aypex.t(:success) %>
              <% end %>
            </span>
          </td>
        </tr>

        <tr>
          <td><strong><%= Aypex.t(:cvv_response) %>:</strong></td>
          <td>
            <span class="badge rounded-pill bg-<%= latest_payment.is_cvv_risky? ? 'void' : 'complete' %>">
              <% if latest_payment.is_cvv_risky? %>
                <%= "#{Aypex.t(:error)}: #{cvv_response_code[latest_payment.cvv_response_code]}" %>
              <% else %>
                <%= Aypex.t(:success) %>
              <% end %>
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</fieldset>
